import{_ as f}from"./index-ByxxC7yn.js";import{i as u,g as h,a as g,c,T as m,q as O,b as y,e as w,f as _,d as E}from"./firebase-DMXZwuxd.js";const s={apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,measurementId:void 0};(!s.apiKey||!s.projectId)&&console.warn("Firebase configuration incomplete. Check .env file for required variables:",{hasApiKey:!!s.apiKey,hasProjectId:!!s.projectId,hasAuthDomain:!!s.authDomain,hasAppId:!!s.appId});let o;try{const t=u(s);o=h(t),console.log("Firebase initialized successfully with project:",s.projectId)}catch(t){throw console.error("Failed to initialize Firebase:",t),t}class n{static ORDERS_COLLECTION="orders";static getBrowserInfo(){const e=navigator.userAgent;let r="Unknown";return e.includes("Firefox")?r="Firefox":e.includes("Chrome")&&!e.includes("Edg")?r="Chrome":e.includes("Safari")&&!e.includes("Chrome")?r="Safari":e.includes("Edg")?r="Edge":(e.includes("Opera")||e.includes("OPR"))&&(r="Opera"),`${r} - ${e}`}static getDeviceType(){const e=navigator.userAgent;return/mobile/i.test(e)?"Mobile":/tablet/i.test(e)?"Tablet":"Desktop"}static async getIPAddress(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip||"Unknown"}catch(e){return console.error("Error fetching IP:",e),"Unknown"}}static async saveOrder(e){try{const r=await this.getIPAddress();return(await g(c(o,this.ORDERS_COLLECTION),{...e,browser_info:this.getBrowserInfo(),device_type:this.getDeviceType(),ip_address:r,created_at:m.now()})).id}catch(r){throw console.error("Error saving order:",r),r}}static async fetchOrders(){try{console.log("Fetching orders from collection:",this.ORDERS_COLLECTION);const e=O(c(o,this.ORDERS_COLLECTION),y("created_at","desc")),r=await w(e);return console.log("Orders fetched successfully. Count:",r.docs.length),r.docs.map(a=>({id:a.id,...a.data()}))}catch(e){throw console.error("Error fetching orders:",e),e instanceof Error&&console.error("Error details:",{message:e.message,code:e.code,name:e.name}),e}}static async deleteOrder(e){try{await _(E(o,this.ORDERS_COLLECTION,e))}catch(r){throw console.error("Error deleting order:",r),r}}static async reprintOrder(e){try{const{setDoc:r,doc:i}=await f(async()=>{const{setDoc:d,doc:l}=await import("./firebase-DMXZwuxd.js").then(p=>p.h);return{setDoc:d,doc:l}},[]),a=i(o,"printer_commands",`reprint_${e}_${Date.now()}`);await r(a,{command_type:"reprint",order_id:e,created_at:new Date().toISOString(),processed:!1})}catch(r){throw console.error("Error sending reprint command:",r),r}}}const C=async t=>n.saveOrder(t),R=async()=>n.fetchOrders(),b=async t=>n.deleteOrder(t),v=async t=>n.reprintOrder(t);export{b as a,o as d,R as f,v as r,C as s};
