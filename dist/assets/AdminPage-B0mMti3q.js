import{j as e}from"./index-ByxxC7yn.js";import{r as d}from"./vendor-DdN_Br3m.js";import{L as ce,k as F,l as z,h as G,m as V,B as Z,R as me,n as xe,o as ue,T as ge,b as he,p as Q,c as be,M as pe,q as J,r as K,G as fe,D as ye,s as je,t as Ne,S as ve,u as we}from"./ui-COUGenCW.js";import{d as H,f as X,r as Se,a as De}from"./orderService-Dn-77eRp.js";import{d as W,o as ke,s as _e}from"./firebase-DMXZwuxd.js";const Ce="Zb^73ZnP9T%Hr!",U=5,Oe=300*1e3,Ee=({onLoginSuccess:s})=>{const[r,n]=d.useState(""),[o,a]=d.useState(""),[i,b]=d.useState(!1),[h,y]=d.useState(0),[f,x]=d.useState(!1),[c,g]=d.useState(null),[j,m]=d.useState(0);d.useEffect(()=>{const u=localStorage.getItem("admin_failed_attempts"),p=localStorage.getItem("admin_block_end");if(u&&y(parseInt(u)),p){const N=parseInt(p),O=Date.now();N>O?(x(!0),g(N),m(Math.ceil((N-O)/1e3))):(localStorage.removeItem("admin_block_end"),localStorage.removeItem("admin_failed_attempts"))}},[]),d.useEffect(()=>{if(!f||!c)return;const u=setInterval(()=>{const p=Date.now(),N=Math.ceil((c-p)/1e3);N<=0?(x(!1),g(null),y(0),localStorage.removeItem("admin_block_end"),localStorage.removeItem("admin_failed_attempts"),a("")):m(N)},1e3);return()=>clearInterval(u)},[f,c]);const D=u=>{const p=Math.floor(u/60),N=u%60;return`${p}:${N.toString().padStart(2,"0")}`},w=u=>{if(u.preventDefault(),a(""),f){a(`Too many failed attempts. Try again in ${D(j)}`);return}if(r===Ce)y(0),localStorage.removeItem("admin_failed_attempts"),localStorage.removeItem("admin_block_end"),s();else{const p=h+1;if(y(p),localStorage.setItem("admin_failed_attempts",p.toString()),p>=U){const N=Date.now()+Oe;x(!0),g(N),localStorage.setItem("admin_block_end",N.toString()),a("Too many failed attempts. Account temporarily blocked for 5 minutes.")}else{const N=U-p;a(`Invalid password. ${N} attempt${N!==1?"s":""} left before temporary block.`)}n(""),b(!0),setTimeout(()=>b(!1),500)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-light-blue-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md ${i?"animate-shake":""}`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-light-blue-100 rounded-full mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-light-blue-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Login"}),e.jsx("p",{className:"text-gray-600",children:"Enter password to access order history"})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:r,onChange:u=>n(u.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-light-blue-400 focus:ring-light-blue-400 transition-colors",placeholder:"Enter admin password",autoComplete:"current-password"})]}),o&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(F,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:o})]}),e.jsx("button",{type:"submit",disabled:!r||f,className:`w-full py-3 px-4 rounded-lg font-semibold transition-all ${!r||f?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-light-blue-400 hover:bg-light-blue-500 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:f?`Blocked - ${D(j)}`:"Login"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Secure admin access"})})]})})},Te=()=>{const[s,r]=d.useState(null),[n,o]=d.useState(!1),[a,i]=d.useState(""),b=async()=>{try{o(!0),i("");const h=W(H,"printer_commands",`test_print_${Date.now()}`);await _e(h,{command_type:"test",created_at:new Date().toISOString(),processed:!1}),alert("Test print command sent! Check printer in a few seconds.")}catch(h){i("Failed to send test print command"),console.error(h)}finally{o(!1)}};return d.useEffect(()=>{const h=W(H,"printer_status","current"),y=ke(h,f=>{if(f.exists()){const x=f.data();r({connected:x.connected||!1,connection_type:x.connection_type||"usb",last_update:x.last_update||new Date().toISOString(),queue_size:x.queue_size||0}),i("")}else r(null),i("Printer status not available yet")},f=>{console.error("Error listening to printer status:",f),i("Failed to connect to printer status updates")});return()=>y()},[]),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Printer Status"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Real-time"})]}),a&&e.jsxs("div",{className:"flex items-start gap-2 bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[e.jsx(F,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:a})]}),s&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.connected?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Connected"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Disconnected"})]})}),e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 rounded p-2 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",s.connection_type]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Queue:"})," ",s.queue_size||0," order(s)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Last Update:"})," ",new Date(s.last_update).toLocaleTimeString("de-DE")]})]}),s.connected&&e.jsx("button",{onClick:b,disabled:n,className:"w-full px-3 py-2 text-sm rounded-lg bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium border border-orange-200",children:n?"Sending...":"Send Test Print"})]})]})},Ae=({onLogout:s,onViewAnalytics:r})=>{const[n,o]=d.useState([]),[a,i]=d.useState([]),[b,h]=d.useState(!0),[y,f]=d.useState(""),[x,c]=d.useState("all"),[g,j]=d.useState(""),[m,D]=d.useState(""),[w,u]=d.useState(""),[p,N]=d.useState(""),[O,M]=d.useState(null),[$,B]=d.useState(null),T=d.useCallback(t=>t.created_at?.toDate?t.created_at.toDate():t.created_at?.seconds?new Date(t.created_at.seconds*1e3):new Date(t.created_at),[]),E=d.useCallback((t,l,S,_)=>{if(l==="all")return t;const v=new Date,oe=new Date(v.getFullYear(),v.getMonth(),v.getDate()),I=new Date(v);I.setDate(v.getDate()-v.getDay()),I.setHours(0,0,0,0);const le=new Date(v.getFullYear(),v.getMonth(),1),de=new Date(v.getFullYear(),0,1);return t.filter(ie=>{const C=T(ie);if(l==="custom"&&S&&_){const R=new Date(S);R.setHours(0,0,0,0);const Y=new Date(_);return Y.setHours(23,59,59,999),C>=R&&C<=Y}switch(l){case"today":return C>=oe;case"week":return C>=I;case"month":return C>=le;case"year":return C>=de;default:return!0}})},[T]),P=d.useCallback(async()=>{h(!0),f("");try{const t=await X();if(o(t),t.length>0){const l=t.map(v=>T(v)),S=new Date(Math.min(...l.map(v=>v.getTime()))),_=new Date(Math.max(...l.map(v=>v.getTime())));u(S.toISOString().split("T")[0]),N(_.toISOString().split("T")[0])}i(E(t,x,g,m))}catch(t){const l=t instanceof Error?t.message:String(t);f(`Failed to load orders: ${l}. Please check Firebase configuration and try again.`),console.error("Error loading orders:",t)}finally{h(!1)}},[E,x,g,m,T]);d.useEffect(()=>{P()},[P]),d.useEffect(()=>{i(E(n,x,g,m))},[x,n,g,m,E]);const ee=()=>{g&&m&&c("custom")},te=t=>{if(!t)return"N/A";if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")return t.toDate().toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});if(typeof t=="object"&&t!==null&&"seconds"in t&&typeof t.seconds=="number")return new Date(t.seconds*1e3).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});const l=new Date(t);return isNaN(l.getTime())?"Invalid Date":l.toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},se=async t=>{if(!(!t||!window.confirm("MÃ¶chten Sie diese Bestellung wirklich lÃ¶schen?"))){M(t);try{await De(t);const S=n.filter(_=>_.id!==t);o(S),i(E(S,x,g,m))}catch(S){console.error("Error deleting order:",S),alert("Fehler beim LÃ¶schen der Bestellung. Bitte versuchen Sie es erneut.")}finally{M(null)}}},re=async t=>{if(t){B(t);try{await Se(t),alert("Bestellung an Drucker gesendet!")}catch(l){console.error("Error reprinting order:",l),alert("Fehler beim erneuten Drucken. Bitte versuchen Sie es erneut.")}finally{B(null)}}},ae=t=>{if(!t)return"ðŸŒ";if(t.startsWith("192.168")||t.startsWith("10.")||t.startsWith("172."))return"ðŸ ";const l=parseInt(t.split(".")[0]);return l>=1&&l<=50?"ðŸ‡ºðŸ‡¸":l>=51&&l<=100?"ðŸ‡¬ðŸ‡§":l>=101&&l<=150?"ðŸ‡©ðŸ‡ª":"ðŸŒ"},ne=a.reduce((t,l)=>t+l.total_amount,0);return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10 border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(V,{className:"w-6 h-6 text-orange-500"}),"Order History"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors font-medium border border-orange-200",children:[e.jsx(Z,{className:"w-4 h-4"}),"Analytics"]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors font-medium border border-orange-200",children:[e.jsx(me,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-red-50 text-red-700 hover:bg-red-100 transition-colors font-medium border border-red-200",children:[e.jsx(xe,{className:"w-4 h-4"}),"Logout"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx(Te,{}),e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:()=>c("all"),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${x==="all"?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"All"}),e.jsx("button",{onClick:()=>c("today"),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${x==="today"?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"Today"}),e.jsx("button",{onClick:()=>c("week"),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${x==="week"?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"Week"}),e.jsx("button",{onClick:()=>c("month"),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${x==="month"?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"Month"}),e.jsx("button",{onClick:()=>c("year"),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${x==="year"?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"Year"})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-3",children:[e.jsx(ue,{className:"w-4 h-4 text-orange-500"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Custom Range"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start"}),e.jsx("input",{type:"date",value:g,onChange:t=>j(t.target.value),min:w,max:p,disabled:!w||!p,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End"}),e.jsx("input",{type:"date",value:m,onChange:t=>D(t.target.value),min:g||w,max:p,disabled:!w||!p,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsx("button",{onClick:ee,disabled:!g||!m,className:"px-4 py-2 text-sm rounded-md bg-orange-500 text-white hover:bg-orange-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Apply"})]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["Orders: ",e.jsx("span",{className:"text-orange-600 font-bold",children:a.length})]}),e.jsxs("p",{className:"font-semibold text-gray-900",children:["Revenue: ",e.jsxs("span",{className:"text-green-600 font-bold",children:[ne.toFixed(2).replace(".",",")," â‚¬"]})]})]})})]}),b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):y?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-sm text-red-700",children:y})}):a.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(V,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No orders found"})]}):e.jsx("div",{className:"space-y-4",children:a.map(t=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[t.printed?e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-50 border border-green-200 rounded text-xs",children:[e.jsx(G,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-green-700",children:"Gedruckt"})]}):t.print_error?e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsx(F,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"text-red-700",children:"Fehler"})]}):null,e.jsx("button",{onClick:()=>re(t.id),disabled:$===t.id,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Erneut drucken",children:$===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>se(t.id),disabled:O===t.id,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Bestellung lÃ¶schen",children:O===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-0",children:[e.jsxs("div",{className:"md:col-span-2 p-4 border-b md:border-b-0 md:border-r border-gray-200 space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between pr-8",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),te(t.created_at)]}),e.jsxs("div",{className:"text-base font-bold text-green-600",children:[t.total_amount.toFixed(2).replace(".",",")," â‚¬"]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:t.customer_name})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(be,{className:"w-3.5 h-3.5"}),e.jsx("a",{href:`tel:${t.customer_phone}`,className:"hover:text-orange-600 transition-colors",children:t.customer_phone})]}),e.jsxs("div",{className:"flex items-start gap-1.5 text-sm text-gray-700",children:[e.jsx(pe,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:t.delivery_address})]})]}),(t.device_type||t.ip_address||t.browser_info)&&e.jsxs("div",{className:"bg-gray-50 rounded border border-gray-200 px-3 py-2 space-y-1",children:[t.device_type&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600",children:[t.device_type==="Mobile"||t.device_type==="Tablet"?e.jsx(J,{className:"w-3 h-3"}):e.jsx(K,{className:"w-3 h-3"}),e.jsx("span",{children:t.device_type})]}),t.ip_address&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600",children:[e.jsx("span",{className:"text-base leading-none",children:ae(t.ip_address)}),e.jsx("span",{className:"font-medium",children:"IP:"}),e.jsx("span",{children:t.ip_address})]}),t.browser_info&&e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Browser:"}),e.jsx("span",{className:"break-all",children:t.browser_info})]})]}),t.notes&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded px-3 py-2",children:e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",t.notes]})})]}),e.jsxs("div",{className:"md:col-span-3 p-4 space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Items"}),e.jsx("div",{className:"space-y-1.5 max-h-64 overflow-y-auto",children:t.items.map((l,S)=>e.jsxs("div",{className:"bg-gray-50 rounded border border-gray-100 p-2.5 hover:border-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-1",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-medium text-sm text-gray-900",children:[l.quantity,"x Nr.",l.menuItemNumber," ",l.name]})}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-semibold text-sm text-green-600",children:[l.totalPrice.toFixed(2).replace(".",",")," â‚¬"]})})]}),e.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[l.selectedSize&&e.jsx("p",{className:"truncate",children:l.selectedSize.name}),l.selectedPastaType&&e.jsxs("p",{children:["Pasta: ",l.selectedPastaType]}),l.selectedSauce&&e.jsxs("p",{children:["Sauce: ",l.selectedSauce]}),l.selectedSideDish&&e.jsxs("p",{children:["Side: ",l.selectedSideDish]}),l.selectedIngredients&&l.selectedIngredients.length>0&&e.jsx("p",{children:l.selectedIngredients.join(", ")}),l.selectedExtras&&l.selectedExtras.length>0&&e.jsxs("p",{className:"text-green-700",children:["+ ",l.selectedExtras.join(", ")]}),l.selectedExclusions&&l.selectedExclusions.length>0&&e.jsxs("p",{className:"text-red-700",children:["- ",l.selectedExclusions.join(", ")]})]})]},S))})]})]})]},t.id))})]})]})},Fe=s=>s&&s==="Abholung"?"pickup":"delivery",Pe=s=>s?s.includes("Firefox")?"Firefox":s.includes("Edg")?"Edge":s.includes("Chrome")?"Chrome":s.includes("Safari")?"Safari":s.includes("Opera")||s.includes("OPR")?"Opera":"Unknown":"Unknown",Ie=(s,r)=>{if(!r&&!s)return"other";const n=(r||"").toLowerCase(),o=(s||"").toLowerCase();return n.includes("iphone")||n.includes("ipad")||n.includes("mac os")?"ios":n.includes("android")||o.includes("mobile")&&n.includes("android")||o.includes("tablet")&&n.includes("android")?"android":"other"},Le=(s,r=10)=>{const n=new Map;return s.forEach(o=>{o.items.forEach(a=>{const i=`${a.menuItemNumber}-${a.name}`,b=n.get(i)||{count:0,revenue:0};n.set(i,{count:b.count+a.quantity,revenue:b.revenue+a.totalPrice})})}),Array.from(n.entries()).map(([o,a])=>({name:o,count:a.count,revenue:a.revenue})).sort((o,a)=>a.count-o.count).slice(0,r)},Me=s=>{const r=s.length,n=s.reduce((c,g)=>c+g.total_amount,0),o=r>0?n/r:0;let a=0,i=0;const b={mobile:0,tablet:0,desktop:0},h={ios:0,android:0},y=new Map;s.forEach(c=>{Fe(c.delivery_address)==="pickup"?a++:i++,c.device_type&&(c.device_type==="Mobile"?b.mobile++:c.device_type==="Tablet"?b.tablet++:c.device_type==="Desktop"&&b.desktop++);const j=Ie(c.device_type,c.browser_info);j==="ios"?h.ios++:j==="android"&&h.android++;const m=Pe(c.browser_info);y.set(m,(y.get(m)||0)+1)});const f=Array.from(y.entries()).map(([c,g])=>({name:c,count:g})).sort((c,g)=>g.count-c.count),x=Le(s,10);return{totalRevenue:n,totalOrders:r,averageOrderValue:o,pickupCount:a,deliveryCount:i,topProducts:x,deviceStats:b,platformStats:h,browserStats:f}},$e=(s,r,n)=>s.filter(o=>{let a;return o.created_at?.toDate?a=o.created_at.toDate():o.created_at?.seconds?a=new Date(o.created_at.seconds*1e3):a=new Date(o.created_at),a>=r&&a<=n}),k=s=>{if(s==null)return"";const r=String(s);return r.includes(",")||r.includes('"')||r.includes(`
`)?`"${r.replace(/"/g,'""')}"`:r},Be=s=>{if(!s)return"";if(typeof s=="object"&&s!==null&&"toDate"in s&&typeof s.toDate=="function")return s.toDate().toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});if(typeof s=="object"&&s!==null&&"seconds"in s&&typeof s.seconds=="number")return new Date(s.seconds*1e3).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});const r=new Date(s);return isNaN(r.getTime())?"":r.toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},Re=s=>s==="Abholung"?"Abholung":"Lieferung",Ye=s=>{const r=["Order Date","Customer Name","Phone","Delivery Address","Order Type","Item Number","Item Name","Item Quantity","Item Price (â‚¬)","Total Amount (â‚¬)","Device Type","Browser Info"],n=[];s.forEach(a=>{a.items.forEach(i=>{n.push({"Order Date":Be(a.created_at),"Customer Name":k(a.customer_name),Phone:k(a.customer_phone),"Delivery Address":k(a.delivery_address),"Order Type":Re(a.delivery_address),"Item Number":i.menuItemNumber,"Item Name":k(i.name),"Item Quantity":i.quantity,"Item Price (â‚¬)":(i.totalPrice/i.quantity).toFixed(2),"Total Amount (â‚¬)":a.total_amount.toFixed(2),"Device Type":a.device_type||"","Browser Info":k(a.browser_info||"")})})});const o=[r.map(k).join(","),...n.map(a=>r.map(i=>k(a[i])).join(","))].join(`
`);return new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"})},Ve=(s,r)=>{const n=document.createElement("a"),o=URL.createObjectURL(s);n.setAttribute("href",o),n.setAttribute("download",r),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},He=s=>{const r=new Date().toISOString().split("T")[0];return`orders-${s}-${r}.csv`},q={green:{icon:"bg-green-50 text-green-600",value:"text-green-600"},orange:{icon:"bg-orange-50 text-orange-600",value:"text-orange-600"},blue:{icon:"bg-blue-50 text-blue-600",value:"text-blue-600"},purple:{icon:"bg-purple-50 text-purple-600",value:"text-purple-600"}},A=({icon:s,label:r,value:n,color:o,subtext:a})=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium mb-1",children:r}),e.jsx("p",{className:`text-3xl font-bold ${q[o].value}`,children:n}),a&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:a})]}),e.jsx("div",{className:`p-3 rounded-lg ${q[o].icon}`,children:s})]})}),We=({products:s})=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Top Products"}),s.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No products to display"})}):e.jsx("div",{className:"space-y-2",children:s.map((r,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-orange-600 bg-orange-50 px-2 py-1 rounded",children:["#",n+1]}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:r.name})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[r.count," orders"]})]}),e.jsx("div",{className:"text-right flex-shrink-0 ml-4",children:e.jsxs("p",{className:"font-semibold text-green-600",children:["â‚¬",r.revenue.toFixed(2)]})})]},n))})]}),L=({title:s,deviceStats:r,osStats:n,browserStats:o})=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[r?e.jsx(K,{className:"w-5 h-5 text-gray-600"}):e.jsx(J,{className:"w-5 h-5 text-gray-600"}),s]}),e.jsxs("div",{className:"space-y-3",children:[r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Mobile"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:r.mobile})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Tablet"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:r.tablet})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Desktop"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:r.desktop})]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"iOS"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:n.ios})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Android"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:n.android})]})]}),o&&o.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:a.name}),e.jsx("span",{className:"text-lg font-bold text-gray-600",children:a.count})]},i))})]})]}),Ue=s=>({de:{today:"Heute",yesterday:"Gestern",week:"Woche",month:"Monat",year:"Jahr",all:"Alle Zeiten"},tr:{today:"BugÃ¼n",yesterday:"DÃ¼n",week:"Hafta",month:"Ay",year:"YÄ±l",all:"TÃ¼m Zamanlar"},en:{today:"Today",yesterday:"Yesterday",week:"Week",month:"Month",year:"Year",all:"All Times"}})[s],qe=["today","yesterday","week","month","year","all"],ze=({selectedPeriod:s,onPeriodChange:r})=>{const[n,o]=d.useState("de"),a=Ue(n);return e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-gray-600"}),e.jsxs("select",{value:n,onChange:i=>o(i.target.value),className:"px-3 py-2 text-sm rounded-md border border-gray-300 bg-white text-gray-700 font-medium hover:border-gray-400 transition-colors cursor-pointer",children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"tr",children:"TÃ¼rkÃ§e"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:qe.map(i=>e.jsx("button",{onClick:()=>r(i),className:`px-4 py-2 text-sm rounded-md font-medium transition-colors ${s===i?"bg-orange-500 text-white border border-orange-600":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:a[i]},i))})]})})},Ge=({onBack:s})=>{const[r,n]=d.useState([]),[o,a]=d.useState(!0),[i,b]=d.useState(""),[h,y]=d.useState("today");d.useEffect(()=>{(async()=>{a(!0),b("");try{const m=await X();n(m)}catch(m){const D=m instanceof Error?m.message:String(m);b(`Failed to load orders: ${D}`),console.error("Error loading orders:",m)}finally{a(!1)}})()},[]);const f=j=>{const m=new Date,D=new Date(m.getFullYear(),m.getMonth(),m.getDate()),w=new Date(m.getFullYear(),m.getMonth(),m.getDate(),23,59,59,999);switch(j){case"today":return[D,w];case"yesterday":{const u=new Date(D);u.setDate(u.getDate()-1);const p=new Date(u);return p.setHours(23,59,59,999),[u,p]}case"week":{const u=new Date(m);return u.setDate(m.getDate()-m.getDay()),u.setHours(0,0,0,0),[u,w]}case"month":return[new Date(m.getFullYear(),m.getMonth(),1),w];case"year":return[new Date(m.getFullYear(),0,1),w];case"all":return[new Date(0),w];default:return[D,w]}},x=d.useMemo(()=>{const[j,m]=f(h);return $e(r,j,m)},[r,h]),c=d.useMemo(()=>Me(x),[x]),g=()=>{try{const j=He(h),m=Ye(x);Ve(m,j)}catch(j){console.error("Error exporting CSV:",j),alert("Failed to export CSV. Please try again.")}};return o?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10 border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Z,{className:"w-6 h-6 text-orange-500"}),"Analytics Dashboard"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Comprehensive sales and customer insights"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:g,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-green-50 text-green-700 hover:bg-green-100 transition-colors font-medium border border-green-200",children:[e.jsx(ye,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 px-4 py-2 text-sm rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors font-medium border border-gray-300",children:[e.jsx(je,{className:"w-4 h-4"}),"Back to Orders"]})]})]})}),i&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:i})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx(ze,{selectedPeriod:h,onPeriodChange:y})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(A,{icon:e.jsx(Ne,{className:"w-6 h-6"}),label:"Total Revenue",value:`â‚¬${c.totalRevenue.toFixed(2)}`,color:"green"}),e.jsx(A,{icon:e.jsx(ve,{className:"w-6 h-6"}),label:"Total Orders",value:c.totalOrders,color:"orange"}),e.jsx(A,{icon:e.jsx(we,{className:"w-6 h-6"}),label:"Average Order Value",value:`â‚¬${c.averageOrderValue.toFixed(2)}`,color:"blue"}),e.jsx(A,{icon:e.jsx(Q,{className:"w-6 h-6"}),label:"Pickup vs Delivery",value:`${c.pickupCount}/${c.deliveryCount}`,color:"purple",subtext:`${c.pickupCount} pickup, ${c.deliveryCount} delivery`})]}),c.topProducts.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(We,{products:c.topProducts})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(L,{title:"Device Statistics",deviceStats:c.deviceStats}),e.jsx(L,{title:"Platform Statistics",osStats:c.platformStats}),c.browserStats.length>0&&e.jsx(L,{title:"Browser Statistics",browserStats:c.browserStats})]})]})]})},et=()=>{const[s,r]=d.useState(!1),[n,o]=d.useState("orders");d.useEffect(()=>{sessionStorage.getItem("admin_authenticated")==="true"&&r(!0)},[]);const a=()=>{r(!0),sessionStorage.setItem("admin_authenticated","true")},i=()=>{r(!1),o("orders"),sessionStorage.removeItem("admin_authenticated")},b=()=>{o("analytics")},h=()=>{o("orders")};return s?e.jsxs(e.Fragment,{children:[n==="orders"&&e.jsx(Ae,{onLogout:i,onViewAnalytics:b}),n==="analytics"&&e.jsx(Ge,{onBack:h})]}):e.jsx(Ee,{onLoginSuccess:a})};export{et as default};
